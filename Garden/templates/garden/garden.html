
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garden</title>
    <style>
        #modal{
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            overflow-y: scroll;

        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            overflow-y: scroll;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat({{ size }}, 1fr);
            aspect-ratio: 1/1;  /* Maintain square aspect ratio */
            height: 60vh;
            max-width: 100%;
            margin: 0 auto;
        }
        .grid-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
    </style>
</head>
<body>
    <div id ="modal">

        <div class="modal-content">
            <span class="close" onclick = "closeModal()">&times;</span>
            <p>Some text in the Modal..</p>
            {% for card in availableCards %}
                <img src="{{MEDIA_URL}}{{card.image}}" alt="{{ card.title }}">
            {% endfor %}
    </div>
    </div>
    {%csrf_token%}
    <div>
        <h1>Garden</h1>
        <p>Here is a list of all the plants in the garden:</p>
        <div class="grid-container">
            {% for row in squares %}
                {% for square in row %}
                    {% if square.cardID %}
                        <img src="{{ square.cardID.image.url }}" data-row ='{{forloop.parentloop.counter}}' data-col=""  onclick="handleCardClick('{{forloop.parentloop.counter}}','{{forloop.counter}}',event)" alt="{{ square.cardID.title }}">
                    {% else %}
                        <img src="{{ MEDIA_URL }}cards/dirt.jpeg" onclick = "openModal('{{forloop.parentloop.counter}}','{{forloop.counter}}')"alt="Default Image">
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </div>
    </div>

    <script>
        function handleCardClick(row, col, event) {
            console.log(event.target);

            // const csrfToken = document.getElementById("csrf_token").value;  // Get CSRF token
            const csrfToken = document.querySelector('[name="csrfmiddlewaretoken"]').value;
            console.log(row, col)
            // console.log(csrfToken)
            fetch('/garden/removeCard/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken // Add CSRF token in the headers
                },
                body: JSON.stringify({ row: row, col: col })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Card removed successfully!");
                    // event.src="{{ MEDIA_URL }}cards/dirt.jpeg";
                    location.reload(); // Refresh the page
                } else {
                    alert("Error: " + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
            
        }

        function openModal(row, col){
            console.log(row, col);
            document.getElementById('modal').style.display = 'block';
        }
        function closeModal(){
            document.getElementById('modal').style.display = 'none';
        }
    </script>
</body>
</html>